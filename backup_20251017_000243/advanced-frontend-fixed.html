<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Customer Service Assistant - Portfolio Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .typing-animation {
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .message-enter {
            animation: messageSlideIn 0.3s ease-out;
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
            50% { box-shadow: 0 0 30px rgba(6, 182, 212, 0.6); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .chat-scroll::-webkit-scrollbar-thumb {
            background: rgba(6, 182, 212, 0.5);
            border-radius: 3px;
        }
        
        .chat-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(6, 182, 212, 0.8);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#06b6d4',
                        secondary: '#3b82f6',
                        accent: '#8b5cf6',
                        darkbg: '#0f0f23',
                        darkcard: '#1a1a2e',
                        botbg: 'rgba(6, 182, 212, 0.1)',
                        userbg: 'rgba(59, 130, 246, 0.1)'
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                    }
                }
            }
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const API_BASE = 'http://localhost:5000/api';

        // Enhanced Message Component with animations
        function Message({ from, text, ts, confidence, intent }) {
            const isUser = from === 'user';
            const [isVisible, setIsVisible] = useState(false);

            useEffect(() => {
                const timer = setTimeout(() => setIsVisible(true), 100);
                return () => clearTimeout(timer);
            }, []);

            const bubbleClass = isUser
                ? 'ml-auto bg-gradient-to-r from-blue-600 to-purple-600 text-white'
                : 'mr-auto glass-effect text-white border-l-4 border-primary';

            const formatText = (text) => {
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-primary">$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em class="text-gray-300">$1</em>');
            };

            return (
                <div className={`max-w-[85%] my-3 transform transition-all duration-300 ${isVisible ? 'translate-y-0 opacity-100' : 'translate-y-4 opacity-0'}`}>
                    <div className={`p-4 rounded-2xl shadow-lg ${bubbleClass} message-enter`}>
                        <div className="flex items-start gap-3">
                            {!isUser && (
                                <div className="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center flex-shrink-0">
                                    <i className="fas fa-robot text-white text-sm"></i>
                                </div>
                            )}
                            <div className="flex-1">
                                <div 
                                    className="whitespace-pre-wrap leading-relaxed"
                                    dangerouslySetInnerHTML={{__html: formatText(text)}}
                                />
                                <div className="flex items-center justify-between mt-2 text-xs">
                                    <span className="text-gray-400">
                                        {new Date(ts).toLocaleTimeString()}
                                    </span>
                                    {!isUser && confidence && (
                                        <div className="flex items-center gap-2">
                                            <span className="text-gray-400">
                                                Intent: <span className="text-primary">{intent}</span>
                                            </span>
                                            <div className="flex items-center gap-1">
                                                <div className="w-2 h-2 rounded-full bg-green-400"></div>
                                                <span className="text-green-400">
                                                    {Math.round(confidence * 100)}%
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                            {isUser && (
                                <div className="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center flex-shrink-0">
                                    <i className="fas fa-user text-white text-sm"></i>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Enhanced MetaBar with real-time stats
        function MetaBar({ sessionId, messageCount, avgConfidence }) {
            const [currentTime, setCurrentTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="glass-effect rounded-xl p-4 mb-4">
                    <div className="flex items-center justify-between text-sm">
                        <div className="flex items-center gap-4">
                            <div className="flex items-center gap-2">
                                <div className="w-2 h-2 rounded-full bg-green-400 pulse-glow"></div>
                                <span className="text-gray-300">Session Active</span>
                            </div>
                            <div className="text-gray-400">
                                ID: <span className="text-primary font-mono">{sessionId.slice(-8)}</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-4 text-gray-400">
                            <span>Messages: <span className="text-white">{messageCount}</span></span>
                            {avgConfidence > 0 && (
                                <span>Avg Confidence: <span className="text-green-400">{Math.round(avgConfidence * 100)}%</span></span>
                            )}
                            <span>{currentTime.toLocaleTimeString()}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Typing Indicator Component
        function TypingIndicator() {
            return (
                <div className="max-w-[85%] my-3 mr-auto">
                    <div className="glass-effect p-4 rounded-2xl border-l-4 border-primary">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center">
                                <i className="fas fa-robot text-white text-sm"></i>
                            </div>
                            <div className="flex items-center gap-1">
                                <div className="w-2 h-2 bg-primary rounded-full typing-animation"></div>
                                <div className="w-2 h-2 bg-primary rounded-full typing-animation" style={{animationDelay: '0.2s'}}></div>
                                <div className="w-2 h-2 bg-primary rounded-full typing-animation" style={{animationDelay: '0.4s'}}></div>
                                <span className="text-gray-400 ml-2">AI is thinking...</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Quick Actions Component
        function QuickActions({ onQuickMessage }) {
            const quickMessages = [
                { icon: 'fas fa-hand-wave', text: 'Hello', message: 'Hello there!' },
                { icon: 'fas fa-box', text: 'Order Status', message: 'Where is my order ORD1001?' },
                { icon: 'fas fa-undo', text: 'Refund', message: 'I want to request a refund' },
                { icon: 'fas fa-headset', text: 'Human Support', message: 'I need to speak with a human agent' },
            ];

            return (
                <div className="mb-4">
                    <div className="text-sm text-gray-400 mb-2">Quick Actions:</div>
                    <div className="flex gap-2 flex-wrap">
                        {quickMessages.map((action, index) => (
                            <button
                                key={index}
                                onClick={() => onQuickMessage(action.message)}
                                className="glass-effect px-3 py-2 rounded-lg text-sm text-white hover:bg-primary/20 transition-all duration-200 flex items-center gap-2 hover:scale-105"
                            >
                                <i className={action.icon}></i>
                                {action.text}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        // Enhanced Chat Component
        function Chat() {
            const [messages, setMessages] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('advanced-pb-chat')) || [];
                } catch {
                    return [];
                }
            });
            const [input, setInput] = useState('');
            const [sessionId] = useState(() => 'session-' + Math.random().toString(36).substring(2, 15));
            const [loading, setLoading] = useState(false);
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef();

            const avgConfidence = messages
                .filter(m => m.from === 'bot' && m.confidence)
                .reduce((acc, m, _, arr) => acc + m.confidence / arr.length, 0);

            useEffect(() => {
                localStorage.setItem('advanced-pb-chat', JSON.stringify(messages));
                if (messagesEndRef.current) {
                    messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [messages]);

            useEffect(() => {
                if (messages.length === 0) {
                    const welcome = {
                        id: 'welcome-' + Date.now(),
                        from: 'bot',
                        text: 'üëã **Welcome to the AI Customer Service Assistant!**\n\nI\'m powered by advanced prompt-based NLU and can help you with:\n‚Ä¢ Order tracking and status updates\n‚Ä¢ Refund and return requests\n‚Ä¢ Product inquiries and support\n‚Ä¢ Human agent escalation\n\nHow can I assist you today?',
                        ts: Date.now(),
                        confidence: 1.0,
                        intent: 'greeting'
                    };
                    setMessages([welcome]);
                }
            }, []);

            const sendMessage = useCallback(async (messageText = input) => {
                if (!messageText.trim()) return;
                
                const userMsg = { 
                    id: 'msg-' + Date.now(), 
                    from: 'user', 
                    text: messageText, 
                    ts: Date.now() 
                };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);
                setIsTyping(true);

                try {
                    // Simulate more realistic typing delay
                    await new Promise(res => setTimeout(res, 800 + Math.random() * 1200));
                    
                    const res = await fetch(`${API_BASE}/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId, message: messageText })
                    });
                    
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    
                    const data = await res.json();
                    const botMsg = {
                        id: 'bot-' + Date.now(),
                        from: 'bot',
                        text: data.reply,
                        ts: Date.now(),
                        confidence: data.confidence,
                        intent: data.intent
                    };
                    setMessages(prev => [...prev, botMsg]);
                } catch (err) {
                    setMessages(prev => [...prev, { 
                        id: 'error-' + Date.now(), 
                        from: 'bot', 
                        text: `‚ö†Ô∏è **Connection Error**\n\nI'm having trouble connecting to my servers. Please check:\n‚Ä¢ Backend server is running on port 5000\n‚Ä¢ Network connection is stable\n\nError: ${err.message}`, 
                        ts: Date.now(),
                        confidence: 0,
                        intent: 'error'
                    }]);
                } finally {
                    setLoading(false);
                    setIsTyping(false);
                }
            }, [input, sessionId]);

            const onKeyDown = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            const clearChat = () => {
                localStorage.removeItem('advanced-pb-chat');
                setMessages([]);
            };

            const requestHuman = async () => {
                try {
                    const res = await fetch(`${API_BASE}/ticket`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            sessionId, 
                            issue: messages.slice(-1)[0]?.text || 'Human support requested via button' 
                        })
                    });
                    const t = await res.json();
                    setMessages(prev => [...prev, { 
                        id: 'ticket-' + Date.now(), 
                        from: 'bot', 
                        text: `üé´ **Human Support Ticket Created**\n\nTicket ID: **${t.ticketId}**\nStatus: **${t.status}**\n\nA human agent will contact you shortly. Average response time is 5-10 minutes during business hours.`, 
                        ts: Date.now(),
                        confidence: 1.0,
                        intent: 'human_escalation'
                    }]);
                } catch {
                    setMessages(prev => [...prev, { 
                        id: 'ticket-error-' + Date.now(), 
                        from: 'bot', 
                        text: '‚ùå **Ticket Creation Failed**\n\nUnable to create support ticket. Please try again or contact support directly.', 
                        ts: Date.now(),
                        confidence: 0,
                        intent: 'error'
                    }]);
                }
            };

            return (
                <div className="h-full flex flex-col">
                    <MetaBar 
                        sessionId={sessionId} 
                        messageCount={messages.length}
                        avgConfidence={avgConfidence}
                    />
                    
                    <div className="flex-1 glass-effect rounded-xl p-4 mb-4 flex flex-col">
                        <div className="flex-1 overflow-auto chat-scroll pr-2">
                            {messages.map(m => (
                                <Message 
                                    key={m.id} 
                                    from={m.from} 
                                    text={m.text} 
                                    ts={m.ts}
                                    confidence={m.confidence}
                                    intent={m.intent}
                                />
                            ))}
                            {isTyping && <TypingIndicator />}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    <QuickActions onQuickMessage={sendMessage} />

                    <div className="glass-effect rounded-xl p-4">
                        <div className="flex gap-3 items-end">
                            <div className="flex-1">
                                <textarea
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyDown={onKeyDown}
                                    placeholder="Type your message here... (Enter to send, Shift+Enter for new line)"
                                    className="w-full p-3 rounded-lg bg-black/30 text-white border border-white/20 focus:border-primary focus:outline-none resize-none transition-all duration-200"
                                    rows={2}
                                    disabled={loading}
                                />
                            </div>
                            <div className="flex flex-col gap-2">
                                <button 
                                    onClick={() => sendMessage()}
                                    disabled={loading || !input.trim()}
                                    className="px-6 py-3 rounded-lg bg-gradient-to-r from-primary to-secondary text-white font-medium hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    <i className="fas fa-paper-plane"></i>
                                    Send
                                </button>
                                <button 
                                    onClick={requestHuman}
                                    className="px-6 py-2 rounded-lg border border-primary text-primary hover:bg-primary/10 transition-all duration-200 flex items-center gap-2 text-sm"
                                >
                                    <i className="fas fa-headset"></i>
                                    Human
                                </button>
                                <button 
                                    onClick={clearChat}
                                    className="px-6 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-white/10 transition-all duration-200 flex items-center gap-2 text-sm"
                                >
                                    <i className="fas fa-trash"></i>
                                    Clear
                                </button>
                            </div>
                        </div>
                        
                        {loading && (
                            <div className="text-primary text-sm mt-2 flex items-center gap-2">
                                <div className="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                                Processing your request...
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Enhanced App Component with portfolio features
        function App() {
            const [showDemo, setShowDemo] = useState(false);

            return (
                <div className="min-h-screen gradient-bg">
                    {/* Header */}
                    <header className="relative overflow-hidden">
                        <div className="max-w-7xl mx-auto px-6 py-8">
                            <div className="text-center">
                                <div className="floating">
                                    <h1 className="text-5xl font-bold text-gradient mb-4">
                                        AI Customer Service Assistant
                                    </h1>
                                </div>
                                <div className="flex items-center justify-center gap-4 mb-8">
                                    <div className="flex items-center gap-2 text-gray-400">
                                        <i className="fab fa-react text-blue-400"></i>
                                        <span>React</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-gray-400">
                                        <i className="fab fa-node-js text-green-400"></i>
                                        <span>Node.js</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-gray-400">
                                        <i className="fas fa-brain text-purple-400"></i>
                                        <span>AI/NLU</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-gray-400">
                                        <i className="fas fa-bolt text-yellow-400"></i>
                                        <span>Real-time</span>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setShowDemo(true)}
                                    className="px-8 py-4 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-xl hover:scale-105 transition-all duration-300 shadow-lg pulse-glow"
                                >
                                    <i className="fas fa-play mr-2"></i>
                                    Launch Interactive Demo
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Demo Section */}
                    {showDemo && (
                        <main className="max-w-6xl mx-auto px-6 pb-8">
                            <div className="h-[80vh]">
                                <Chat />
                            </div>
                        </main>
                    )}

                    {/* Features Section */}
                    {!showDemo && (
                        <section className="max-w-6xl mx-auto px-6 py-12">
                            <div className="grid md:grid-cols-3 gap-8">
                                <div className="glass-effect rounded-xl p-6 hover:scale-105 transition-all duration-300">
                                    <div className="text-primary text-3xl mb-4">
                                        <i className="fas fa-brain"></i>
                                    </div>
                                    <h3 className="text-xl font-semibold text-white mb-3">Intelligent NLU</h3>
                                    <p className="text-gray-400">
                                        Advanced prompt-based natural language understanding with intent detection, 
                                        confidence scoring, and context awareness.
                                    </p>
                                </div>
                                
                                <div className="glass-effect rounded-xl p-6 hover:scale-105 transition-all duration-300">
                                    <div className="text-secondary text-3xl mb-4">
                                        <i className="fas fa-comments"></i>
                                    </div>
                                    <h3 className="text-xl font-semibold text-white mb-3">Real-time Chat</h3>
                                    <p className="text-gray-400">
                                        Smooth, responsive chat interface with typing indicators, 
                                        message animations, and persistent conversation history.
                                    </p>
                                </div>
                                
                                <div className="glass-effect rounded-xl p-6 hover:scale-105 transition-all duration-300">
                                    <div className="text-accent text-3xl mb-4">
                                        <i className="fas fa-chart-line"></i>
                                    </div>
                                    <h3 className="text-xl font-semibold text-white mb-3">Analytics & Insights</h3>
                                    <p className="text-gray-400">
                                        Real-time conversation analytics, confidence tracking, 
                                        and performance metrics for continuous improvement.
                                    </p>
                                </div>
                            </div>
                        </section>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
